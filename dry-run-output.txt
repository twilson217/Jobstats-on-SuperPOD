BCM Jobstats Deployment - Dry Run Commands
==================================================

  1. which cmsh
  2. cmsh -c 'wlm;get prolog;get epilog;get epilogslurmctld'
  3. cmsh -c 'wlm;use slurm;show' | grep -E '(prolog|epilog)'
  4. cmsh -c 'show' | head -1
  5. ssh slurm-controller-01 'mkdir -p /opt/jobstats-deployment'
  6. ssh slurm-controller-01 'test -d /opt/jobstats-deployment/jobstats'
  7. ssh slurm-controller-01 'cd /opt/jobstats-deployment/jobstats && git pull'
  8. ssh slurm-controller-01 'mkdir -p /cm/shared/apps/slurm/var/cm'
  9. ssh slurm-controller-01 'cp /opt/jobstats-deployment/jobstats/jobstats/slurm/prolog.d/gpustats_helper.sh /cm/shared/apps/slurm/var/cm/prolog-jobstats.sh'
 10. ssh slurm-controller-01 'chmod +x /cm/shared/apps/slurm/var/cm/prolog-jobstats.sh'
 11. ssh slurm-controller-01 'cp /opt/jobstats-deployment/jobstats/jobstats/slurm/epilog.d/gpustats_helper.sh /cm/shared/apps/slurm/var/cm/epilog-jobstats.sh'
 12. ssh slurm-controller-01 'chmod +x /cm/shared/apps/slurm/var/cm/epilog-jobstats.sh'
 13. ssh slurm-controller-01 'mkdir -p /cm/local/apps/slurm/var/prologs'
 14. ssh slurm-controller-01 'mkdir -p /cm/local/apps/slurm/var/epilogs'
 15. ssh slurm-controller-01 'ln -sf /cm/shared/apps/slurm/var/cm/prolog-jobstats.sh /cm/local/apps/slurm/var/prologs/60-prolog-jobstats.sh'
 16. ssh slurm-controller-01 'ln -sf /cm/shared/apps/slurm/var/cm/epilog-jobstats.sh /cm/local/apps/slurm/var/epilogs/60-epilog-jobstats.sh'
 17. ssh slurm-controller-01 'cp /opt/jobstats-deployment/jobstats/jobstats/slurm/slurmctldepilog.sh /usr/local/sbin/'
 18. ssh slurm-controller-01 'chmod +x /usr/local/sbin/slurmctldepilog.sh'
 19. ssh login-node-01 'apt update'
 20. ssh login-node-01 'apt install -y python3-requests python3-blessed'
 21. ssh login-node-01 'mkdir -p /opt/jobstats-deployment'
 22. ssh login-node-01 'test -d /opt/jobstats-deployment/jobstats'
 23. ssh login-node-01 'cd /opt/jobstats-deployment/jobstats && git pull'
 24. ssh login-node-01 'cp /opt/jobstats-deployment/jobstats/jobstats/jobstats /usr/local/bin/'
 25. ssh login-node-01 'cp /opt/jobstats-deployment/jobstats/jobstats/jobstats.py /usr/local/bin/'
 26. ssh login-node-01 'cp /opt/jobstats-deployment/jobstats/jobstats/output_formatters.py /usr/local/bin/'
 27. ssh login-node-01 'cp /opt/jobstats-deployment/jobstats/jobstats/config.py /usr/local/bin/'
 28. ssh login-node-01 'chmod +x /usr/local/bin/jobstats'
 29. ssh login-node-02 'apt update'
 30. ssh login-node-02 'apt install -y python3-requests python3-blessed'
 31. ssh login-node-02 'mkdir -p /opt/jobstats-deployment'
 32. ssh login-node-02 'test -d /opt/jobstats-deployment/jobstats'
 33. ssh login-node-02 'cd /opt/jobstats-deployment/jobstats && git pull'
 34. ssh login-node-02 'cp /opt/jobstats-deployment/jobstats/jobstats/jobstats /usr/local/bin/'
 35. ssh login-node-02 'cp /opt/jobstats-deployment/jobstats/jobstats/jobstats.py /usr/local/bin/'
 36. ssh login-node-02 'cp /opt/jobstats-deployment/jobstats/jobstats/output_formatters.py /usr/local/bin/'
 37. ssh login-node-02 'cp /opt/jobstats-deployment/jobstats/jobstats/config.py /usr/local/bin/'
 38. ssh login-node-02 'chmod +x /usr/local/bin/jobstats'
 39. ssh dgx-node-01 'apt update'
 40. ssh dgx-node-01 'apt install -y golang-go build-essential'
 41. ssh dgx-node-01 'mkdir -p /opt/jobstats-deployment'
 42. ssh dgx-node-01 'test -d /opt/jobstats-deployment/cgroup_exporter'
 43. ssh dgx-node-01 'cd /opt/jobstats-deployment/cgroup_exporter && git pull'
 44. ssh dgx-node-01 'test -d /opt/jobstats-deployment/nvidia_gpu_prometheus_exporter'
 45. ssh dgx-node-01 'cd /opt/jobstats-deployment/nvidia_gpu_prometheus_exporter && git pull'
 46. ssh dgx-node-01 'test -d /opt/jobstats-deployment/node_exporter'
 47. ssh dgx-node-01 'cd /opt/jobstats-deployment/node_exporter && git pull'
 48. ssh dgx-node-01 'cd /opt/jobstats-deployment/cgroup_exporter && go build -o cgroup_exporter'
 49. ssh dgx-node-01 'cp /opt/jobstats-deployment/cgroup_exporter/cgroup_exporter /usr/local/bin/'
 50. ssh dgx-node-01 'cd /opt/jobstats-deployment/nvidia_gpu_prometheus_exporter && go build -o nvidia_gpu_prometheus_exporter'
 51. ssh dgx-node-01 'cp /opt/jobstats-deployment/nvidia_gpu_prometheus_exporter/nvidia_gpu_prometheus_exporter /usr/local/bin/'
 52. ssh dgx-node-01 'cd /opt/jobstats-deployment/node_exporter && make build'
 53. ssh dgx-node-01 'cp /opt/jobstats-deployment/node_exporter/node_exporter /usr/local/bin/'
 54. ssh dgx-node-01 'useradd --no-create-home --shell /bin/false prometheus || true'
 55. ssh dgx-node-01 'cp /tmp/tmpgsc_eeaz /etc/systemd/system/cgroup_exporter.service'
 56. ssh dgx-node-01 'cp /tmp/tmpx0bptq7w /etc/systemd/system/node_exporter.service'
 57. ssh dgx-node-01 'cp /tmp/tmpums3bxxi /etc/systemd/system/nvidia_gpu_prometheus_exporter.service'
 58. ssh dgx-node-01 'systemctl daemon-reload'
 59. ssh dgx-node-01 'systemctl enable cgroup_exporter'
 60. ssh dgx-node-01 'systemctl start cgroup_exporter'
 61. ssh dgx-node-01 'systemctl daemon-reload'
 62. ssh dgx-node-01 'systemctl enable node_exporter'
 63. ssh dgx-node-01 'systemctl start node_exporter'
 64. ssh dgx-node-01 'systemctl daemon-reload'
 65. ssh dgx-node-01 'systemctl enable nvidia_gpu_prometheus_exporter'
 66. ssh dgx-node-01 'systemctl start nvidia_gpu_prometheus_exporter'
 67. ssh dgx-node-02 'apt update'
 68. ssh dgx-node-02 'apt install -y golang-go build-essential'
 69. ssh dgx-node-02 'mkdir -p /opt/jobstats-deployment'
 70. ssh dgx-node-02 'test -d /opt/jobstats-deployment/cgroup_exporter'
 71. ssh dgx-node-02 'cd /opt/jobstats-deployment/cgroup_exporter && git pull'
 72. ssh dgx-node-02 'test -d /opt/jobstats-deployment/nvidia_gpu_prometheus_exporter'
 73. ssh dgx-node-02 'cd /opt/jobstats-deployment/nvidia_gpu_prometheus_exporter && git pull'
 74. ssh dgx-node-02 'test -d /opt/jobstats-deployment/node_exporter'
 75. ssh dgx-node-02 'cd /opt/jobstats-deployment/node_exporter && git pull'
 76. ssh dgx-node-02 'cd /opt/jobstats-deployment/cgroup_exporter && go build -o cgroup_exporter'
 77. ssh dgx-node-02 'cp /opt/jobstats-deployment/cgroup_exporter/cgroup_exporter /usr/local/bin/'
 78. ssh dgx-node-02 'cd /opt/jobstats-deployment/nvidia_gpu_prometheus_exporter && go build -o nvidia_gpu_prometheus_exporter'
 79. ssh dgx-node-02 'cp /opt/jobstats-deployment/nvidia_gpu_prometheus_exporter/nvidia_gpu_prometheus_exporter /usr/local/bin/'
 80. ssh dgx-node-02 'cd /opt/jobstats-deployment/node_exporter && make build'
 81. ssh dgx-node-02 'cp /opt/jobstats-deployment/node_exporter/node_exporter /usr/local/bin/'
 82. ssh dgx-node-02 'useradd --no-create-home --shell /bin/false prometheus || true'
 83. ssh dgx-node-02 'cp /tmp/tmp_4d8ku91 /etc/systemd/system/cgroup_exporter.service'
 84. ssh dgx-node-02 'cp /tmp/tmpf5dtfesn /etc/systemd/system/node_exporter.service'
 85. ssh dgx-node-02 'cp /tmp/tmptf4evxe5 /etc/systemd/system/nvidia_gpu_prometheus_exporter.service'
 86. ssh dgx-node-02 'systemctl daemon-reload'
 87. ssh dgx-node-02 'systemctl enable cgroup_exporter'
 88. ssh dgx-node-02 'systemctl start cgroup_exporter'
 89. ssh dgx-node-02 'systemctl daemon-reload'
 90. ssh dgx-node-02 'systemctl enable node_exporter'
 91. ssh dgx-node-02 'systemctl start node_exporter'
 92. ssh dgx-node-02 'systemctl daemon-reload'
 93. ssh dgx-node-02 'systemctl enable nvidia_gpu_prometheus_exporter'
 94. ssh dgx-node-02 'systemctl start nvidia_gpu_prometheus_exporter'
 95. ssh dgx-node-03 'apt update'
 96. ssh dgx-node-03 'apt install -y golang-go build-essential'
 97. ssh dgx-node-03 'mkdir -p /opt/jobstats-deployment'
 98. ssh dgx-node-03 'test -d /opt/jobstats-deployment/cgroup_exporter'
 99. ssh dgx-node-03 'cd /opt/jobstats-deployment/cgroup_exporter && git pull'
100. ssh dgx-node-03 'test -d /opt/jobstats-deployment/nvidia_gpu_prometheus_exporter'
101. ssh dgx-node-03 'cd /opt/jobstats-deployment/nvidia_gpu_prometheus_exporter && git pull'
102. ssh dgx-node-03 'test -d /opt/jobstats-deployment/node_exporter'
103. ssh dgx-node-03 'cd /opt/jobstats-deployment/node_exporter && git pull'
104. ssh dgx-node-03 'cd /opt/jobstats-deployment/cgroup_exporter && go build -o cgroup_exporter'
105. ssh dgx-node-03 'cp /opt/jobstats-deployment/cgroup_exporter/cgroup_exporter /usr/local/bin/'
106. ssh dgx-node-03 'cd /opt/jobstats-deployment/nvidia_gpu_prometheus_exporter && go build -o nvidia_gpu_prometheus_exporter'
107. ssh dgx-node-03 'cp /opt/jobstats-deployment/nvidia_gpu_prometheus_exporter/nvidia_gpu_prometheus_exporter /usr/local/bin/'
108. ssh dgx-node-03 'cd /opt/jobstats-deployment/node_exporter && make build'
109. ssh dgx-node-03 'cp /opt/jobstats-deployment/node_exporter/node_exporter /usr/local/bin/'
110. ssh dgx-node-03 'useradd --no-create-home --shell /bin/false prometheus || true'
111. ssh dgx-node-03 'cp /tmp/tmpm9xkav5u /etc/systemd/system/cgroup_exporter.service'
112. ssh dgx-node-03 'cp /tmp/tmpbwvj1v0l /etc/systemd/system/node_exporter.service'
113. ssh dgx-node-03 'cp /tmp/tmpfypb3k7_ /etc/systemd/system/nvidia_gpu_prometheus_exporter.service'
114. ssh dgx-node-03 'systemctl daemon-reload'
115. ssh dgx-node-03 'systemctl enable cgroup_exporter'
116. ssh dgx-node-03 'systemctl start cgroup_exporter'
117. ssh dgx-node-03 'systemctl daemon-reload'
118. ssh dgx-node-03 'systemctl enable node_exporter'
119. ssh dgx-node-03 'systemctl start node_exporter'
120. ssh dgx-node-03 'systemctl daemon-reload'
121. ssh dgx-node-03 'systemctl enable nvidia_gpu_prometheus_exporter'
122. ssh dgx-node-03 'systemctl start nvidia_gpu_prometheus_exporter'
